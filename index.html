<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>트릭컬 최애 사도 진단</title>
<style>
  :root {
    --bg: #0b0f14;
    --panel: #111827;
    --text: #111827;
    --muted: #6b7280;
    --accent: #8b5cf6;
    --btn: #1f2937;
  }
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0;
    background: var(--bg);
    color: var(--text);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
    position: relative;
  }

  /* 배경 이미지: 원본 색감 그대로 */
  body::before{
    content:"";
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
    background: url("이미지/배경.jpg") center/cover no-repeat fixed;
  }

  .wrap { min-height: 100%; display:flex; align-items:center; justify-content:center; padding:24px; }
  .card {
    width: min(860px, 96vw);
    background: #ffffff;  /* 반투명 화이트 */
    color: #111827;
    border: 1px solid rgba(0,0,0,0.1);
    border-radius: 18px;
    box-shadow: 0 20px 80px rgba(0,0,0,.25);
    position: relative;
    z-index: 1;
  }

  .header {
    position: absolute;
    top: 20px; left: 24px;
    display: flex; align-items: center; gap: 10px;
    font-weight: 700; letter-spacing: .3px;
    color: #111827;
  }
  .brand .dot { width:10px; height:10px; border-radius:50%; background: var(--accent); box-shadow:0 0 10px var(--accent); }

  .body { padding: 80px 28px 28px 28px; text-align: center; }
  .title { font-size: clamp(22px, 3.5vw, 30px); font-weight: 800; line-height:1.2; }
  .subtitle { margin-top: 10px; color: #000000; }
  .btn {
    display:inline-flex; align-items:center; justify-content:center;
    background: linear-gradient(180deg, var(--accent), #6d28d9);
    border:none; color:white; padding:14px 20px; border-radius:12px;
    font-weight:700; cursor:pointer;
    box-shadow:0 10px 30px rgba(139,92,246,.35);
    transition:filter .2s ease;
  }
  .btn:hover { filter: brightness(1.07); }

  .qbox { margin-top: 16px; padding:18px; background: #f9fafb; border:1px solid rgba(0,0,0,.05); border-radius:14px; text-align:left; }
  .qtitle { font-size: clamp(18px, 2.5vw, 22px); font-weight:800; }
  .opts { display:grid; gap:10px; margin-top:14px; }
  .opt { background:#e5e7eb; border:none; padding:12px 14px; border-radius:12px; cursor:pointer; text-align:left; }
  .opt:hover { background:#ddd6fe; }
  .footer { display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:18px; color:#6b7280; }
  .pill { padding:4px 10px; border-radius:999px; background:rgba(139,92,246,.15); color:#6d28d9; font-size:12px; }

  .result { display:grid; grid-template-columns:330px 1fr; gap:18px; }
  @media (max-width:780px){ .result{grid-template-columns:1fr;} }
  .portrait img { width:100%; border-radius:12px; border:1px solid rgba(0,0,0,.1); }

  .name { margin-top:10px; font-size:20px; font-weight:800; }
  .desc { color:#6b7280; }
  .badgebar { display:flex; flex-wrap:wrap; gap:8px; margin-top:12px; }
  .badge { font-size:12px; padding:5px 9px; border-radius:999px; background:#f3f4f6; border:1px solid #e5e7eb; }
  .hr { height:1px; background: linear-gradient(90deg, transparent, rgba(0,0,0,.1), transparent); margin:18px 0; }
</style>
</head>
<body>
<div class="wrap">
  <div class="card" id="app">
    <div class="header">
      <div class="brand"><span class="dot"></span> 트릭컬 최애 사도 진단</div>
    </div>
    <div class="body" id="view"></div>
  </div>
</div>

<script>
// 질문지와 캐릭터 데이터 동일
const QUESTIONS = [
  {id:'personality',title:'Q1. 위험에 빠졌을 때, 당신은 어떻게 행동하나요?',options:[
    {label:'미친 듯이 돌진해 상황을 바꾼다',value:'광기'},
    {label:'모두를 위해 자신을 희생한다',value:'우울'},
    {label:'감정을 누르고 냉정하게 판단한다',value:'냉정'},
    {label:'동료를 믿고 주저 없이 달려간다',value:'순수'},
    {label:'모두를 격려하며 분위기를 이끈다',value:'활발'},
  ]},
  {id:'archetype',title:'Q2. 당신이 이상적으로 되고 싶은 모습은?',options:[
    {label:'혼돈 속에서도 웃는 자유인',value:'트릭스터'},
    {label:'진실을 탐구하는 관찰자',value:'현자'},
    {label:'정의를 위해 싸우는 리더',value:'영웅'},
    {label:'억압에 맞서는 반항자',value:'반역자'},
    {label:'상처 입은 이를 보듬는 보호자',value:'보호자'},
  ]},
  {id:'role',title:'Q3. 전투가 시작되면, 당신은 어떤 역할이 편합니까?',options:[
    {label:'가장 먼저 적에게 돌격하는 공격수',value:'딜러'},
    {label:'아군의 상태를 살피는 지원자',value:'서포터'},
    {label:'한 걸음 앞에서 파티를 지키는 방패',value:'탱커'},
  ]},
  {id:'attack',title:'Q4. 힘의 근원은 어디서 온다고 보나요?',options:[
    {label:'육체의 단련과 감각',value:'물리'},
    {label:'지식, 감정, 그리고 마력',value:'마법'},
  ]},
  {id:'line',title:'Q5. 전장에서 가장 편한 위치는?',options:[
    {label:'적과 정면 대치하는 전열',value:'전열'},
    {label:'전황을 읽고 균형을 잡는 중열',value:'중열'},
    {label:'멀리서 관찰하고 지원하는 후열',value:'후열'},
  ]},
];

const CHARACTERS = [
  {id:'다야',name:'다야',img:'이미지/다야.png',desc:'용족의 수장',traits:{성격:'순수',원형:'',역할:'딜러',공격:'마법',배치:'후열'}},
  {id:'이프리트',name:'이프리트',img:'이미지/이프리트.png',desc:'라떼 정령',traits:{성격:'광기',원형:'',역할:'딜러',공격:'마법',배치:'전열'}},
  {id:'코미',name:'코미',img:'이미지/코미.png',desc:'수인 독서왕',traits:{성격:'우울',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
  {id:'마에스트로 2호',name:'마에스트로 2호',img:'이미지/마에스트로.png',desc:'최고 사양 로봇',traits:{성격:'광기',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
  {id:'네르',name:'네르',img:'이미지/네르.png',desc:'최고위 사제',traits:{성격:'광기',원형:'',역할:'서포터',공격:'마법',배치:'전열'}},
  {id:'림',name:'림',img:'이미지/림.png',desc:'썰렁개그 권위자',traits:{성격:'우울',원형:'',역할:'딜러',공격:'물리',배치:'전열'}},
  {id:'스피키',name:'스피키',img:'이미지/스피키.png',desc:'과몰입 전문 유령',traits:{성격:'순수',원형:'',역할:'서포터',공격:'마법',배치:'후열'}},
  {id:'실라',name:'실라',img:'이미지/실라.png',desc:'최고 명사수',traits:{성격:'냉정',원형:'',역할:'딜러',공격:'물리',배치:'후열'}},
  {id:'벨벳',name:'벨벳',img:'이미지/벨벳.png',desc:'근력강화 마법 전문',traits:{성격:'냉정',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
  {id:'빅우드',name:'빅우드',img:'이미지/빅우드.png',desc:'가장 용감한 정령',traits:{성격:'순수',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
  {id:'제이드',name:'제이드',img:'이미지/제이드.png',desc:'귀 얆다고 놀리지 마',traits:{성격:'냉정',원형:'',역할:'딜러',공격:'마법',배치:'중열'}},
  {id:'아멜리아',name:'아멜리아',img:'이미지/아멜리아.png',desc:'자타공인 최고의 비서',traits:{성격:'냉정',원형:'',역할:'서포터',공격:'물리',배치:'후열'}},
  {id:'벨리타',name:'벨리타',img:'이미지/벨리타.png',desc:'최고위 마녀',traits:{성격:'광기',원형:'',역할:'딜러',공격:'마법',배치:'후열'}},
  {id:'에르핀',name:'에르핀',img:'이미지/에르핀.png',desc:'요정 여왕',traits:{성격:'순수',원형:'',역할:'딜러',공격:'마법',배치:'후열'}},
  {id:'루포',name:'루포',img:'이미지/루포.png',desc:'사료스탕스 지식왕',traits:{성격:'활발',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'에슈르',name:'에슈르',img:'이미지/에슈르.png',desc:'엘리아스 제빵왕',traits:{성격:'우울',원형:'',역할:'딜러',공격:'마법',배치:'후열'}},
  {id:'엘레나',name:'엘레나',img:'이미지/엘레나.png',desc:'엘프의 참리더',traits:{성격:'냉정',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'프리클',name:'프리클',img:'이미지/프리클.png',desc:'벨리타의 보좌관',traits:{성격:'냉정',원형:'',역할:'딜러',공격:'마법',배치:'중열'}},
  {id:'키디언',name:'키디언',img:'이미지/키디언.png',desc:'자발적 아웃사이더',traits:{성격:'우울',원형:'',역할:'딜러',공격:'물리',배치:'전열'}},
  {id:'루드',name:'루드',img:'이미지/루드.png',desc:'근육으로 승부한다',traits:{성격:'활발',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
  {id:'셰이디',name:'셰이디',img:'이미지/셰이디.png',desc:'못된 장난 전문',traits:{성격:'광기',원형:'',역할:'딜러',공격:'물리',배치:'전열'}},
  {id:'디아나',name:'디아나',img:'이미지/디아나.png',desc:'세월이 준 현명함',traits:{성격:'광기',원형:'',역할:'서포터',공격:'마법',배치:'중열'}},
  {id:'가비아',name:'가비아',img:'이미지/가비아.png',desc:'가장 조용한 정령',traits:{성격:'순수',원형:'',역할:'서포터',공격:'마법',배치:'중열'}},
  {id:'칸나',name:'칸나',img:'이미지/칸나.png',desc:'오락실 패왕',traits:{성격:'활발',원형:'',역할:'딜러',공격:'물리',배치:'후열'}},
  {id:'베니',name:'베니',img:'이미지/베니.png',desc:'사료스탕스의 힘',traits:{성격:'활발',원형:'',역할:'딜러',공격:'물리',배치:'전열'}},
  {id:'시스트',name:'시스트',img:'이미지/시스트.png',desc:'사기꾼 꿈나무',traits:{성격:'광기',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'버터',name:'버터',img:'이미지/버터.png',desc:'친구 좋아 좋아',traits:{성격:'활발',원형:'',역할:'딜러',공격:'물리',배치:'후열'}},
  {id:'페스타',name:'페스타',img:'이미지/페스타.png',desc:'엘리아스 최고의 락커',traits:{성격:'우울',원형:'',역할:'서포터',공격:'물리',배치:'전열'}},
  {id:'레비',name:'레비',img:'이미지/레비.png',desc:'아르바이트 전문가',traits:{성격:'우울',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'마리',name:'마리',img:'이미지/마리.png',desc:'폭발물 취급 가능',traits:{성격:'활발',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'멜루나',name:'멜루나',img:'이미지/멜루나.png',desc:'저작권 수입 1위',traits:{성격:'냉정',원형:'',역할:'서포터',공격:'마법',배치:'후열'}},
  {id:'포셔',name:'포셔',img:'이미지/포셔.png',desc:'포션 제작 장인',traits:{성격:'우울',원형:'',역할:'서포터',공격:'마법',배치:'후열'}},
  {id:'쥬비',name:'쥬비',img:'이미지/쥬비.png',desc:'꿀 생산량 1위',traits:{성격:'활발',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'에스피',name:'에스피',img:'이미지/에스피.png',desc:'꿈 엿보기 스페셜리스트',traits:{성격:'냉정',원형:'',역할:'서포터',공격:'마법',배치:'후열'}},
  {id:'마고',name:'마고',img:'이미지/마고.png',desc:'평화를 사랑하는 수인',traits:{성격:'순수',원형:'',역할:'서포터',공격:'마법',배치:'중열'}},
  {id:'마요',name:'마요',img:'이미지/마요.png',desc:'최고의 장물 수집가',traits:{성격:'광기',원형:'',역할:'딜러',공격:'물리',배치:'후열'}},
  {id:'로네',name:'로네',img:'이미지/로네.png',desc:'최고의 스파이?',traits:{성격:'순수',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
  {id:'시온 더 다크불릿',name:'시온 더 다크불릿',img:'이미지/시온 더 다크불릿.png',desc:'검은 마탄의 사수',traits:{성격:'우울',원형:'',역할:'딜러',공격:'물리',배치:'후열'}},
  {id:'클로에',name:'클로에',img:'이미지/클로에.png',desc:'인형 샌드백 권위자',traits:{성격:'광기',원형:'',역할:'탱커',공격:'마법',배치:'전열'}},
  {id:'아야',name:'아야',img:'이미지/아야.png',desc:'만년설의 현자',traits:{성격:'냉정',원형:'',역할:'딜러',공격:'마법',배치:'중열'}},
  {id:'우이',name:'우이',img:'이미지/우이.png',desc:'긍정의 힘',traits:{성격:'활발',원형:'',역할:'서포터',공격:'마법',배치:'중열'}},
  {id:'레이지',name:'레이지',img:'이미지/레이지.png',desc:'일 시키시려고요?',traits:{성격:'냉정',원형:'',역할:'딜러',공격:'물리',배치:'후열'}},
  {id:'메죵',name:'메죵',img:'이미지/메죵.png',desc:'여기가 새 집인가?',traits:{성격:'광기',원형:'',역할:'딜러',공격:'물리',배치:'후열'}},
  {id:'밍스',name:'밍스',img:'이미지/밍스.png',desc:'그렇게 하는 거 아니라니까!',traits:{성격:'활발',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'베루',name:'베루',img:'이미지/베루.png',desc:'너 약점투성이구나?',traits:{성격:'우울',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'사리',name:'사리',img:'이미지/사리.png',desc:'먼저 운을 띄워줘.',traits:{성격:'순수',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'알레트',name:'알레트',img:'이미지/알레트.png',desc:'전입신고합니다!',traits:{성격:'순수',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
  {id:'유미미',name:'유미미',img:'이미지/유미미.png',desc:'캬~ 풀냄새가 좋았어~',traits:{성격:'광기',원형:'',역할:'딜러',공격:'물리',배치:'후열'}},
  {id:'쵸피',name:'쵸피',img:'이미지/쵸피.png',desc:'어떻게든 강해져서 인정받을 거야!',traits:{성격:'우울',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'카렌',name:'카렌',img:'이미지/카렌.png',desc:'당근 빠따죠!',traits:{성격:'활발',원형:'',역할:'딜러',공격:'마법',배치:'후열'}},
  {id:'큐이',name:'큐이',img:'이미지/큐이.png',desc:'오이오이, 기다렸던거냐구?',traits:{성격:'순수',원형:'',역할:'서포터',공격:'마법',배치:'중열'}},
  {id:'타이다',name:'타이다',img:'이미지/타이다.png',desc:'앗? 노, 놀던 거 아니에요!',traits:{성격:'활발',원형:'',역할:'딜러',공격:'물리',배치:'후열'}},
  {id:'파트라',name:'파트라',img:'이미지/파트라.png',desc:'주방에서는 진지하게!',traits:{성격:'냉정',원형:'',역할:'딜러',공격:'물리',배치:'전열'}},
  {id:'티그',name:'티그',img:'이미지/티그.png',desc:'수인 최고의 검',traits:{성격:'활발',원형:'',역할:'딜러',공격:'물리',배치:'전열'}},
  {id:'나이아',name:'나이아',img:'이미지/나이아.png',desc:'사교성은 내가 최고!',traits:{성격:'순수',원형:'',역할:'서포터',공격:'마법',배치:'중열'}},
  {id:'실피르',name:'실피르',img:'이미지/실피르.png',desc:'자존심이 밥 먹여준다',traits:{성격:'우울',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'비비',name:'비비',img:'이미지/비비.png',desc:'용족 성골 귀족',traits:{성격:'순수',원형:'',역할:'탱커',공격:'마법',배치:'전열'}},
  {id:'힐데',name:'힐데',img:'이미지/힐데.png',desc:'만년 레지던트',traits:{성격:'우울',원형:'',역할:'서포터',공격:'마법',배치:'중열'}},
  {id:'셀리네',name:'셀리네',img:'이미지/셀리네.png',desc:'도발의 여왕',traits:{성격:'활발',원형:'',역할:'탱커',공격:'마법',배치:'전열'}},
  {id:'에피카',name:'에피카',img:'이미지/에피카.png',desc:'엘리아스의 음유시인',traits:{성격:'활발',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'앨리스',name:'앨리스',img:'이미지/앨리스.png',desc:'카드 점 전문',traits:{성격:'광기',원형:'',역할:'딜러',공격:'마법',배치:'중열'}},
  {id:'리츠',name:'리츠',img:'이미지/리츠.png',desc:'만번 담근 강철',traits:{성격:'광기',원형:'',역할:'딜러',공격:'물리',배치:'전열'}},
  {id:'피코라',name:'피코라',img:'이미지/피코라.png',desc:'엘리아스 패셔니스타',traits:{성격:'냉정',원형:'',역할:'서포터',공격:'마법',배치:'후열'}},
  {id:'블랑셰',name:'블랑셰',img:'이미지/블랑셰.png',desc:'무대 위의 푸른 장미',traits:{성격:'우울',원형:'',역할:'딜러',공격:'마법',배치:'중열'}},
  {id:'이드',name:'이드',img:'이미지/이드.png',desc:'이터널 드리머',traits:{성격:'냉정',원형:'',역할:'탱커',공격:'마법',배치:'전열'}},
  {id:'슈팡',name:'슈팡',img:'이미지/슈팡.png',desc:'익스트림 스피드스터',traits:{성격:'활발',원형:'',역할:'서포터',공격:'마법',배치:'후열'}},
  {id:'캬롯',name:'캬롯',img:'이미지/캬롯.png',desc:'수제작 농부',traits:{성격:'순수',원형:'',역할:'서포터',공격:'마법',배치:'후열'}},
  {id:'롤렛',name:'롤렛',img:'이미지/롤렛.png',desc:'오지랖 마에스트로',traits:{성격:'광기',원형:'',역할:'딜러',공격:'마법',배치:'후열'}},
  {id:'바나',name:'바나',img:'이미지/바나.png',desc:'망치질의 대가',traits:{성격:'활발',원형:'',역할:'서포터',공격:'물리',배치:'후열'}},
  {id:'리스티',name:'리스티',img:'이미지/리스티.png',desc:'리얼 라이프 해커',traits:{성격:'우울',원형:'',역할:'딜러',공격:'물리',배치:'후열'}},
  {id:'코미(수영복)',name:'코미(수영복)',img:'이미지/코미(수영복).png',desc:'퍼리 비이치 리조토의 사장',traits:{성격:'냉정',원형:'',역할:'서포터',공격:'마법',배치:'중열'}},
  {id:'리뉴아',name:'리뉴아',img:'이미지/리뉴아.png',desc:'의문의 극장 알바',traits:{성격:'광기',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'헤일리',name:'헤일리',img:'이미지/헤일리.png',desc:'자칭 엘프 선봉대 장교',traits:{성격:'순수',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'레테',name:'레테',img:'이미지/레테.png',desc:'망각의 유령',traits:{성격:'냉정',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
  {id:'모모',name:'모모',img:'이미지/모모.png',desc:'언젠가는 최강 닌자',traits:{성격:'활발',원형:'',역할:'딜러',공격:'마법',배치:'후열'}},
  {id:'바롱',name:'바롱',img:'이미지/바롱.png',desc:'허언 허세 허클베리',traits:{성격:'냉정',원형:'',역할:'딜러',공격:'마법',배치:'전열'}},
  {id:'바리에',name:'바리에',img:'이미지/바리에.png',desc:'공공도서관의 짠내 담당',traits:{성격:'우울',원형:'',역할:'서포터',공격:'마법',배치:'후열'}},
  {id:'스노키',name:'스노키',img:'이미지/스노키.png',desc:'언더그라운드 갱스터',traits:{성격:'우울',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
  {id:'피라',name:'피라',img:'이미지/피라.png',desc:'전직 뒷골목 이자 콜렉터',traits:{성격:'광기',원형:'',역할:'서포터',공격:'물리',배치:'후열'}},
  {id:'셰럼',name:'셰럼',img:'이미지/셰럼.png',desc:'마녀 사관',traits:{성격:'순수',원형:'',역할:'탱커',공격:'마법',배치:'전열'}},
  {id:'칸타',name:'칸타',img:'이미지/칸타.png',desc:'최강 팽이 배틀러',traits:{성격:'냉정',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'죠안',name:'죠안',img:'이미지/죠안.png',desc:'찐근본 교단사제',traits:{성격:'우울',원형:'',역할:'서포터',공격:'물리',배치:'모든 열'}},
  {id:'그윈',name:'그윈',img:'이미지/그윈.png',desc:'세상의 탐험가',traits:{성격:'냉정',원형:'',역할:'서포터',공격:'마법',배치:'전열'}},
  {id:'폴랑',name:'폴랑',img:'이미지/폴랑.png',desc:'에르피엔 경비대장',traits:{성격:'광기',원형:'',역할:'서포터',공격:'물리',배치:'후열'}},
  {id:'스피키(메이드)',name:'스피키(메이드)',img:'이미지/스피키(메이드).png',desc:'펌킨 파티 메이드',traits:{성격:'활발',원형:'',역할:'딜러',공격:'마법',배치:'후열'}},
  {id:'리온',name:'리온',img:'이미지/리온.png',desc:'수수께끼의 히어로',traits:{성격:'우울',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
  {id:'오팔',name:'오팔',img:'이미지/오팔.png',desc:'퓨어큐어 파티피플',traits:{성격:'순수',원형:'',역할:'서포터',공격:'물리',배치:'중열'}},
  {id:'란',name:'란',img:'이미지/란.png',desc:'고독한 늑대',traits:{성격:'순수',원형:'',역할:'딜러',공격:'마법',배치:'후열'}},
  {id:'림(혼돈)',name:'림(혼돈)',img:'이미지/림(혼돈).png',desc:'대체된 혼돈',traits:{성격:'광기',원형:'',역할:'딜러',공격:'물리',배치:'후열'}},
  {id:'아이시아',name:'아이시아',img:'이미지/아이시아.png',desc:'모나티엄 2등 기업 CEO',traits:{성격:'냉정',원형:'',역할:'딜러',공격:'마법',배치:'후열'}},
  {id:'샤샤',name:'샤샤',img:'이미지/샤샤.png',desc:'왕국의 특별 소방 요정',traits:{성격:'우울',원형:'',역할:'딜러',공격:'마법',배치:'중열'}},
  {id:'슈로',name:'슈로',img:'이미지/슈로.png',desc:'비늘의 아이',traits:{성격:'활발',원형:'',역할:'서포터',공격:'물리',배치:'전열'}},
  {id:'라이카',name:'라이카',img:'이미지/라이카.png',desc:'번개의 고위 정령',traits:{성격:'순수',원형:'',역할:'딜러',공격:'물리',배치:'전열'}},
  {id:'벨라',name:'벨라',img:'이미지/벨라.png',desc:'꺼지지 않는 존재',traits:{성격:'활발',원형:'',역할:'탱커',공격:'마법',배치:'전열'}},
  {id:'네티',name:'네티',img:'이미지/네티.png',desc:'고고한 고고학자',traits:{성격:'광기',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
  {id:'리코타',name:'리코타',img:'이미지/리코타.png',desc:'어둠 속의 요리사',traits:{성격:'냉정',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
  {id:'마요(멋짐)',name:'마요(멋짐)',img:'이미지/마요(멋짐).png',desc:'컬렉터의 근본',traits:{성격:'순수',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'오르',name:'오르',img:'이미지/오르.png',desc:'다재다능 발명가',traits:{성격:'우울',원형:'',역할:'서포터',공격:'마법',배치:'후열'}},
  {id:'디아나(왕년)',name:'디아나(왕년)',img:'이미지/디아나(왕년).png',desc:'왕년의 최강자',traits:{성격:'냉정',원형:'',역할:'딜러',공격:'물리',배치:'전열'}},
  {id:'아르코',name:'아르코',img:'이미지/아르코.png',desc:'그레이트 그레이프 댄서',traits:{성격:'활발',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'캐시',name:'캐시',img:'이미지/캐시.png',desc:'자칭 공포의 유령',traits:{성격:'순수',원형:'',역할:'딜러',공격:'물리',배치:'후열'}},
  {id:'아네트',name:'아네트',img:'이미지/아네트.png',desc:'싸움 구경 전문가',traits:{성격:'광기',원형:'',역할:'서포터',공격:'마법',배치:'중열'}},
  {id:'로네(시장)',name:'로네(시장)',img:'이미지/로네(시장).png',desc:'새 시장 새 도시',traits:{성격:'우울',원형:'',역할:'딜러',공격:'물리',배치:'중열'}},
  {id:'마카샤',name:'마카샤',img:'이미지/마카샤.png',desc:'이야기를 짓는 자',traits:{성격:'활발',원형:'',역할:'서포터',공격:'마법',배치:'중열'}},
  {id:'시저',name:'시저',img:'이미지/시저.png',desc:'최고의 빌런 지망생',traits:{성격:'냉정',원형:'',역할:'서포터',공격:'마법',배치:'중열'}},
  {id:'뮤트',name:'뮤트',img:'이미지/뮤트.png',desc:'배후에 숨은 전략가',traits:{성격:'순수',원형:'',역할:'서포터',공격:'마법',배치:'후열'}},
  {id:'우로스',name:'우로스',img:'이미지/우로스.png',desc:'자신과 싸우는 자',traits:{성격:'공명',원형:'',역할:'서포터',공격:'물리',배치:'후열'}},
  {id:'티그(영웅)',name:'티그(영웅)',img:'이미지/티그(영웅).png',desc:'마침내 일어선 영웅',traits:{성격:'광기',원형:'',역할:'딜러',공격:'물리',배치:'모든 열'}},
  {id:'미로',name:'미로',img:'이미지/미로.png',desc:'흘깃거리는 거울의 정령',traits:{성격:'활발',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
  {id:'아사나',name:'아사나',img:'이미지/아사나.png',desc:'유연한 요가 연구가',traits:{성격:'우울',원형:'',역할:'탱커',공격:'물리',배치:'전열'}},
];

// 가중치
const WEIGHTS = {성격:5, 원형:4, 역할:3, 공격:2, 배치:1};

// 상태
let answers={}, step='start';
const view=document.getElementById('view');
function html(s,...v){return s.reduce((a,b,i)=>a+b+(v[i]??''),'');}
function setView(n){view.innerHTML=n;}

// === 추가: 포함/와일드카드 매칭 헬퍼 ===
function includesTrait(charVal, answerVal){
  // 다중값(배열) 지원
  if (Array.isArray(charVal)) return charVal.includes(answerVal);

  // 성격 공명 = 모든 성격 허용
  if (typeof charVal === 'string' && charVal === '공명'){
    return ['광기','우울','냉정','순수','활발'].includes(answerVal);
  }

  // 배치 와일드카드 표기 허용
  if (typeof charVal === 'string' && ['모든','모든 열','ALL','Any','any'].includes(charVal)){
    return true;
  }

  // 일반 단일값
  return charVal === answerVal;
}

// === 교체: 점수 계산 ===
function scoreFor(c, profile){
  let sum = 0;
  for (const key of Object.keys(WEIGHTS)){
    if (includesTrait(c.traits[key], profile[key])) sum += WEIGHTS[key];
  }
  return sum;
}

// === 교체: 매칭 로직 ===
function matchCharacter(profile){
  // 1) 정확일치: 배열/공명/모든 열 허용
  const exact = CHARACTERS.find(c =>
    Object.keys(WEIGHTS).every(k => includesTrait(c.traits[k], profile[k]))
  );
  if (exact) return { character: exact, score: scoreFor(exact, profile), profile };

  // 2) 가중 유사도 + 특이도(구체적일수록 우선)
  let best=null, bestScore=-Infinity, bestSpec=-Infinity;
  for (const c of CHARACTERS){
    const s = scoreFor(c, profile);
    const spec = Object.keys(WEIGHTS).reduce((acc,k)=>{
      const v = c.traits[k];
      if (Array.isArray(v)) return acc + 1/Math.max(1,v.length);         // 값 많을수록 특이도 낮음
      if (typeof v === 'string' && (v === '공명' || ['모든','모든 열','ALL','Any','any'].includes(v))) return acc + 0.25; // 와일드카드 낮게
      return acc + 1;                                                     // 단일값은 높게
    },0);
    if (s > bestScore || (s === bestScore && spec > bestSpec)){
      best = c; bestScore = s; bestSpec = spec;
    }
  }
  return { character: best, score: bestScore, profile };
}

// 화면 렌더
function renderStart(){
  setView(html`
    <div class="center">
      <div class="title">꾜주님! 꾜주님의 최애 사도를 알려드릴게요!</div>
      <div class="subtitle">버튼을 누르면 5문항 설문이 시작됩니다.</div>
      <div style="margin-top:18px"><button class="btn" onclick="startQuiz()">사도 모집 시작하기</button></div>
      <div class="hr"></div>
      <div class="mutetext">© 팬메이드 설문 데모</div>
    </div>
  `);
}

function renderQuestion(i){
  const q=QUESTIONS[i];
  setView(html`
    <div class="qbox">
      <div class="pill">${i+1} / ${QUESTIONS.length}</div>
      <div class="qtitle" style="margin-top:8px">${q.title}</div>
      <div class="opts">
        ${q.options.map((op,j)=>`<button class="opt" onclick="choose(${i},${j})">${op.label}</button>`).join('')}
      </div>
    </div>
  `);
}

function renderResult(match){
  const {character,score,profile}=match;
  setView(html`
    <div class="result">
      <div class="portrait">
        <img src="${character.img}" alt="${character.name}"/>
        <div class="name">${character.name}</div>
        <div class="desc">${character.desc}</div>
      </div>
      <div>
        <div class="title">당신의 최애 사도 후보</div>
        <div class="subtitle">유사도 가중 합: ${score}</div>
        <div class="badgebar">
          ${Object.entries(profile).map(([k,v])=>`<span class="badge">${k}: ${v}</span>`).join('')}
        </div>
        <div class="hr"></div>
        <button class="btn" onclick="restart()">설문 다시 시작하기</button>
      </div>
    </div>
  `);
}

function startQuiz(){answers={};renderQuestion(0);}
function choose(i,j){
  const q=QUESTIONS[i];
  const mapKey = { personality:'성격', archetype:'원형', role:'역할', attack:'공격', line:'배치' }[q.id];
  answers[mapKey]=q.options[j].value;
  if(i+1<QUESTIONS.length) renderQuestion(i+1);
  else renderResult(matchCharacter(answers));
}
function restart(){renderStart();}
renderStart();
</script>
</body>
</html>
